Name: xs-opam-src
Version: @VERSION@
Release: 1%{?dist}
Summary: Opam repository
License: Various
URL: http://github.com/lindig/xs-opam
AutoReqProv: no

Source000: https://github.com/lindig/xs-opam/archive/master/xs-opam-master.tar.gz
# sources.spec

BuildRequires: opam
BuildRequires: rsync

%description
Opam repository containing all upstream and development libraries
required for building the OCaml components in the XS Toolstack.

%prep
%setup -q -n xs-opam-master
# link all source files into build/src/
mkdir -p build/src
grep -v '^#' sources.txt | while read p url
do
  file=$(basename $url)
  (cd build/src; test -f $file || ln -s ../../../../SOURCES/$file .)
done

%build
make repo

%install
mkdir -p %{buildroot}/usr/share/opam-repository
(cd build && rsync -avz  archives packages %{buildroot}/usr/share/opam-repository/)
chmod o+w -R %{buildroot}/usr/share/opam-repository

# create opam root
mkdir -p %{buildroot}/usr/lib/opamroot
chmod 777 %{buildroot}/usr/lib/opamroot


%files
/usr/share/opam-repository
/usr/lib/opamroot
%attr(777, root, root) /usr/lib/opamroot

%changelog
* Tue Dec 20 2016 Christian Lindig <christian.lindig@citrix.com> - 0.0.1-1 
- Initial version

